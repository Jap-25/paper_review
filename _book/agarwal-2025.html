<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Agarwal et al. (2024)">

<title>6&nbsp; Population Dynamics - FM – Paper Review: IA y Territorio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./reza-2025.html" rel="next">
<link href="./han-2018.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles/style.css">
</head>

<body class="nav-sidebar floating slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./urban.html">Urbanismo - IA</a></li><li class="breadcrumb-item"><a href="./agarwal-2025.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Population Dynamics - FM</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Paper Review: IA y Territorio</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Prefacio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introducción</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./remote_sensing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Percepción Remota - IA</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./brown-2025.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Alpha Earth Foundation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fang-2026.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Earth Embeddings as Products</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./urban.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Urbanismo - IA</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./han-2018.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">LLM - Urban Agents</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./agarwal-2025.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Population Dynamics - FM</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reza-2025.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Crix - Crime and Demographics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fleischmann-2025.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">The Hierarchical Morphotope Classification</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./presentaciones.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Presentaciones</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./template_paper.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Template</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contenidos</h2>
   
  <ul>
  <li><a href="#información-básica" id="toc-información-básica" class="nav-link active" data-scroll-target="#información-básica"><span class="header-section-number">6.1</span> Información Básica</a></li>
  <li><a href="#abstract" id="toc-abstract" class="nav-link" data-scroll-target="#abstract"><span class="header-section-number">6.2</span> Abstract</a></li>
  <li><a href="#preguntas-de-investigación-hipótesis" id="toc-preguntas-de-investigación-hipótesis" class="nav-link" data-scroll-target="#preguntas-de-investigación-hipótesis"><span class="header-section-number">6.3</span> Preguntas de Investigación / Hipótesis</a></li>
  <li><a href="#metodología" id="toc-metodología" class="nav-link" data-scroll-target="#metodología"><span class="header-section-number">6.4</span> Metodología</a>
  <ul class="collapse">
  <li><a href="#flujo-de-trabajo" id="toc-flujo-de-trabajo" class="nav-link" data-scroll-target="#flujo-de-trabajo"><span class="header-section-number">6.4.1</span> Flujo de trabajo</a></li>
  <li><a href="#modelos-algoritmos" id="toc-modelos-algoritmos" class="nav-link" data-scroll-target="#modelos-algoritmos"><span class="header-section-number">6.4.2</span> Modelos / Algoritmos</a></li>
  <li><a href="#datos" id="toc-datos" class="nav-link" data-scroll-target="#datos"><span class="header-section-number">6.4.3</span> Datos</a></li>
  <li><a href="#validación-uncertainties" id="toc-validación-uncertainties" class="nav-link" data-scroll-target="#validación-uncertainties"><span class="header-section-number">6.4.4</span> Validación &amp; Uncertainties</a></li>
  <li><a href="#replicabilidad-recursos" id="toc-replicabilidad-recursos" class="nav-link" data-scroll-target="#replicabilidad-recursos"><span class="header-section-number">6.4.5</span> Replicabilidad &amp; Recursos</a></li>
  </ul></li>
  <li><a href="#resultados-clave" id="toc-resultados-clave" class="nav-link" data-scroll-target="#resultados-clave"><span class="header-section-number">6.5</span> Resultados Clave</a></li>
  <li><a href="#discusión" id="toc-discusión" class="nav-link" data-scroll-target="#discusión"><span class="header-section-number">6.6</span> Discusión</a></li>
  <li><a href="#aplicabilidad-en-chile" id="toc-aplicabilidad-en-chile" class="nav-link" data-scroll-target="#aplicabilidad-en-chile"><span class="header-section-number">6.7</span> Aplicabilidad en Chile</a></li>
  <li><a href="#madurez-evidencia" id="toc-madurez-evidencia" class="nav-link" data-scroll-target="#madurez-evidencia"><span class="header-section-number">6.8</span> Madurez &amp; Evidencia</a></li>
  <li><a href="#impacto-en-políticas-públicas-ods" id="toc-impacto-en-políticas-públicas-ods" class="nav-link" data-scroll-target="#impacto-en-políticas-públicas-ods"><span class="header-section-number">6.9</span> Impacto en Políticas Públicas / ODS</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./urban.html">Urbanismo - IA</a></li><li class="breadcrumb-item"><a href="./agarwal-2025.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Population Dynamics - FM</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Population Dynamics - FM</span></h1>
<p class="subtitle lead">General Geospatial Inference with a Population Dynamics Foundation Model</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><span class="citation" data-cites="agarwal2024pdfm">Agarwal et al. (<a href="references.html#ref-agarwal2024pdfm" role="doc-biblioref">2024</a>)</span> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/agawarl-logo.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="300"></p>
</figure>
</div>
<section id="información-básica" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="información-básica"><span class="header-section-number">6.1</span> Información Básica</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Elemento</th>
<th>Detalle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Referencia corta</strong></td>
<td>Agarwal et al., 2025 (PDFM)</td>
</tr>
<tr class="even">
<td><strong>Título completo</strong></td>
<td>General Geospatial Inference with a Population Dynamics Foundation Model</td>
</tr>
<tr class="odd">
<td><strong>Revista / Volumen / DOI</strong></td>
<td>arXiv preprint (cs.LG); arXiv:2411.07207v4; 30 Jan 2025. DOI: <a href="https://doi.org/10.48550/arXiv.2411.07207" class="uri">https://doi.org/10.48550/arXiv.2411.07207</a></td>
</tr>
<tr class="even">
<td><strong>Temática</strong></td>
<td>IA geoespacial; modelos fundacionales; grafos; salud pública; factores socioeconómicos; medio ambiente; forecasting</td>
</tr>
<tr class="odd">
<td><strong>Contexto / Problema</strong></td>
<td>La toma de decisiones en salud pública, bienestar social y ambiente requiere inferencias geoespaciales robustas con datos heterogéneos y desbalanceados. Métodos tradicionales dependen de <em>features</em> y modelos específicos por tarea, dificultando la escalabilidad a nuevas variables, resoluciones y regiones. El trabajo propone un modelo fundacional (PDFM) que sintetiza múltiples modalidades para producir <em>embeddings</em> reutilizables en tareas de interpolación, extrapolación, super‑resolución y apoyo a pronósticos.</td>
</tr>
<tr class="even">
<td><strong>Keywords</strong></td>
<td>Foundation model; geospatial embeddings; Graph Neural Networks; GraphSAGE; interpolation; extrapolation; super‑resolution; forecasting; TimesFM; Data Commons; CDC PLACES; SatCLIP; GeoCLIP</td>
</tr>
</tbody>
</table>
</section>
<section id="abstract" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="abstract"><span class="header-section-number">6.2</span> Abstract</h2>
<blockquote class="blockquote">
<p><strong>Original:</strong><br>
Supporting the health and well-being of dynamic populations around the world requires governmental agencies, organizations, and researchers to understand and reason over complex relationships between human behavior and local contexts. This support includes identifying populations at elevated risk and gauging where to target limited aid resources. Traditional approaches to these classes of problems often entail developing manually curated, task-specific features and models to represent human behavior and the natural and built environment, which can be challenging to adapt to new, or even related tasks. To address this, we introduce the Population Dynamics Foundation Model (PDFM), which aims to capture the relationships between diverse data modalities and is applicable to a broad range of geospatial tasks. We first construct a geo-indexed dataset for postal codes and counties across the United States, capturing rich aggregated information on human behavior from maps, busyness, and aggregated search trends, and environmental factors such as weather and air quality. We then model this data and the complex relationships between locations using a graph neural network, producing embeddings that can be adapted to a wide range of downstream tasks using relatively simple models. We evaluate the effectiveness of our approach by benchmarking it on 27 downstream tasks spanning three distinct domains: health indicators, socioeconomic factors, and environmental measurements. The approach achieves state-of-the-art performance on geospatial interpolation across all tasks, surpassing existing satellite and geotagged image based location encoders. In addition, it achieves state-of-the-art performance in extrapolation and super-resolution for 25 of the 27 tasks. We also show that the PDFM can be combined with a state-of-the-art forecasting foundation model, TimesFM, to predict unemployment and poverty, achieving performance that surpasses fully supervised forecasting. The full set of embeddings and sample code are publicly available for researchers. In conclusion, we have demonstrated a general purpose approach to geospatial modeling tasks critical to understanding population dynamics by leveraging a rich set of complementary globally available datasets that can be readily adapted to previously unseen machine learning tasks.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Traducción al español:</strong><br>
Apoyar la salud y el bienestar de poblaciones dinámicas exige comprender y razonar sobre relaciones complejas entre el comportamiento humano y los contextos locales. Esto incluye identificar poblaciones en mayor riesgo y orientar recursos limitados. Los enfoques tradicionales suelen requerir <em>features</em> y modelos específicos por tarea para representar comportamiento humano y entorno natural/ construido, lo que dificulta su adaptación a tareas nuevas o afines. Para abordarlo, se introduce el <strong>Population Dynamics Foundation Model (PDFM)</strong>, que busca capturar relaciones entre diversas modalidades de datos y es aplicable a un amplio rango de tareas geoespaciales. Primero, se construye un conjunto geo‑indexado para códigos postales y condados de EE.UU., con información agregada rica sobre comportamiento humano (mapas, afluencia/“busyness”, tendencias de búsqueda agregadas) y factores ambientales (clima y calidad del aire). Luego, se modelan estos datos y las relaciones complejas entre lugares mediante una red neuronal de grafos, produciendo <em>embeddings</em> adaptables a muchas tareas con modelos sencillos. La eficacia se evalúa con 27 tareas en tres dominios: indicadores de salud, factores socioeconómicos y mediciones ambientales. El enfoque logra <em>state‑of‑the‑art</em> (SoTA) en interpolación para todas las tareas, superando codificadores basados en satélite e imágenes geolocalizadas; y alcanza SoTA en extrapolación y super‑resolución para 25 de 27 tareas. Además, se muestra que PDFM puede combinarse con el modelo fundacional de pronóstico TimesFM para predecir desempleo y pobreza, superando a un pronóstico totalmente supervisado. Se liberan <em>embeddings</em> y código de ejemplo. En síntesis, se demuestra un enfoque general para modelado geoespacial crítico para entender la dinámica poblacional, aprovechando conjuntos de datos complementarios, globalmente disponibles, fácilmente adaptables a tareas inéditas.</p>
</blockquote>
</section>
<section id="preguntas-de-investigación-hipótesis" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="preguntas-de-investigación-hipótesis"><span class="header-section-number">6.3</span> Preguntas de Investigación / Hipótesis</h2>
<blockquote class="blockquote">
<ul>
<li>¿Puede un modelo fundacional geoespacial, basado en GNN y datos multimodales, generar <em>embeddings</em> generales que superen a codificadores de localización existentes (p.ej., SatCLIP/GeoCLIP) en interpolación, extrapolación y super‑resolución? <em>(inferida)</em><br>
</li>
<li>¿Pueden estos <em>embeddings</em> mejorar pronósticos univariados (TimesFM) de indicadores socioeconómicos (desempleo, pobreza) mediante una capa adaptadora simple? <em>(inferida)</em></li>
</ul>
</blockquote>
</section>
<section id="metodología" class="level2 page-columns page-full" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="metodología"><span class="header-section-number">6.4</span> Metodología</h2>
<section id="flujo-de-trabajo" class="level3 page-columns page-full" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="flujo-de-trabajo"><span class="header-section-number">6.4.1</span> Flujo de trabajo</h3>
<ol type="1">
<li><strong>Fase 1 – Modelo fundacional (PDFM):</strong> construcción de un grafo geoespacial (códigos postales y condados como nodos; aristas por proximidad y similitud de comportamiento) e integración de modalidades (tendencias de búsqueda agregadas, POIs en mapas, <em>busyness</em>, clima y calidad del aire; además embeddings SatCLIP como variante). Entrenamiento auto‑supervisado para reconstruir <em>features</em> por fuente y obtener <em>embeddings</em> desagregados por modalidad.<br>
</li>
<li><strong>Fase 2 – Tareas downstream:</strong> uso de <em>embeddings</em> como covariables en modelos ligeros (Ridge, GBDT, MLP) para <strong>interpolación</strong>, <strong>extrapolación</strong> y <strong>super‑resolución</strong> de 27 variables (salud, socioeconomía, ambiente).<br>
<!-- 3.  **Pronóstico:** combinación de **TimesFM** (decoder‑only preentrenado) con un **MLP adaptador** que toma *embeddings* PDFM + predicción TimesFM (t‑1) para corregir errores y proyectar desempleo (condado) y pobreza (ZIP). --></li>
</ol>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="images/agawarl-pases.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">Training and Applying the Population Dynamics Foundation Model</figcaption>
</figure>
</div>
</section>
<section id="modelos-algoritmos" class="level3" data-number="6.4.2">
<h3 data-number="6.4.2" class="anchored" data-anchor-id="modelos-algoritmos"><span class="header-section-number">6.4.2</span> Modelos / Algoritmos</h3>
<blockquote class="blockquote">
<p><strong>PDFM (GNN GraphSAGE):</strong> muestreo de subgrafos hasta 4 saltos; agregación <em>pooling</em>; una ronda de <em>message passing</em>; capa lineal final (≈330 dim); entrenamiento auto‑supervisado con pérdida Huber; <em>embeddings</em> con <strong>partición por fuente</strong> (0‑127 Búsquedas; 128‑255 Mapas/Busyness; 256‑329 Clima/Calidad aire).<br>
<strong>Downstream:</strong> Ridge, <strong>LightGBM</strong> (GBDT; hasta 3000 árboles; 31 hojas; <em>lr</em> 0.02), <strong>MLP</strong> (512‑256‑128, ReLU, <em>dropout</em> 0.2, Adam, 40 épocas).<br>
<strong>Pronóstico:</strong> TimesFM + MLP adaptador (2 capas) para corrección de errores.</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/agawarl-graph.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="600"></p>
</figure>
</div>
</section>
<section id="datos" class="level3" data-number="6.4.3">
<h3 data-number="6.4.3" class="anchored" data-anchor-id="datos"><span class="header-section-number">6.4.3</span> Datos</h3>
<p>El estudio integra <strong>cinco fuentes principales</strong> a nivel <strong>código postal y condado</strong> en la <strong>CONUS</strong> (EE.UU. continental).</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Tipo</th>
<th>Fuente</th>
<th>Cobertura temporal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Tendencias de búsqueda agregadas</td>
<td>Agregados anónimos (Sun et al.&nbsp;2024)</td>
<td>Julio 2022</td>
</tr>
<tr class="even">
<td>Mapas (POIs)</td>
<td>Google Maps (1,192 categorías)</td>
<td>Mayo 2024</td>
</tr>
<tr class="odd">
<td>Busyness (afluencia)</td>
<td>Agregados por categoría de POI</td>
<td>1er semestre 2024</td>
</tr>
<tr class="even">
<td>Clima &amp; Calidad del aire</td>
<td>Reanálisis / estaciones (variables met &amp; AQ)</td>
<td>Julio 2022</td>
</tr>
<tr class="odd">
<td>Satélite (embeddings)</td>
<td>SatCLIP (Sentinel‑2, ViT16‑L40)</td>
<td>2021–2023</td>
</tr>
<tr class="even">
<td>Etiquetas salud</td>
<td>CDC PLACES vía Data Commons</td>
<td>Año 2022</td>
</tr>
<tr class="odd">
<td>Socioeconómicas (espaciales)</td>
<td>Data Commons (ingresos, vivienda, población, night lights)</td>
<td>2022</td>
</tr>
<tr class="even">
<td>Pronóstico (desempleo)</td>
<td>Condado, mensual</td>
<td>1990–2024</td>
</tr>
<tr class="odd">
<td>Pronóstico (pobreza)</td>
<td>ZIP, anual</td>
<td>2011–2022</td>
</tr>
</tbody>
</table>
<p><strong>Datos Fase 1</strong></p>
<ol type="i">
<li><strong>Tendencias de búsqueda agregadas</strong> (jul‑2022).</li>
<li><strong>Mapas (POIs)</strong> (may‑2024).</li>
<li><strong>Busyness</strong> (H1‑2024).</li>
<li><strong>Clima &amp; Calidad del aire</strong> (jul‑2022).</li>
</ol>
<ul>
<li>Embeddings de comparación y complemento: <strong>SatCLIP</strong> (2021‑2023).</li>
</ul>
<p><strong>Datos Fase 2</strong></p>
<ul>
<li>Etiquetas <em>downstream</em> provienen de <strong>Data Commons / CDC PLACES (2022)</strong> y catálogos (p.ej., <em>night lights</em>, elevación).</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/agawarl-tematics.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="600"></p>
</figure>
</div>
</section>
<section id="validación-uncertainties" class="level3" data-number="6.4.4">
<h3 data-number="6.4.4" class="anchored" data-anchor-id="validación-uncertainties"><span class="header-section-number">6.4.4</span> Validación &amp; Uncertainties</h3>
<p>Se diseñan <strong>tres evaluaciones espaciales</strong>: interpolación (holdout 20% condados), extrapolación (holdout 20% estados) y super‑resolución (entrenar en condado, probar en ZIP). Métricas: <strong>R²</strong>, <strong>correlación de Pearson (r)</strong> y <strong>MAPE</strong>. Se comparan <strong>IDW</strong>, <strong>SatCLIP</strong>, <strong>GeoCLIP</strong> y <strong>PDFM</strong>; además, ablaciones por modalidad.</p>
<p><img src="images/agarwal-pdfm-interp-bars.png" class="img-fluid"></p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Métrica</th>
<th>Valor</th>
<th>Alcance</th>
<th>Notas</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>R² medio = <strong>0.83</strong></td>
<td>PDFM</td>
<td>Interpolación (27 tareas)</td>
<td>Salud (media) <strong>0.73</strong>; Elevación <strong>0.96</strong>, Night Lights <strong>0.93</strong></td>
</tr>
<tr class="even">
<td>R² medio = <strong>0.70</strong></td>
<td>PDFM</td>
<td>Extrapolación (27 tareas)</td>
<td>Salud (media) <strong>0.58</strong>; Tree cover GeoCLIP <strong>0.69</strong> (mejor en esa tarea)</td>
</tr>
<tr class="odd">
<td>r medio = <strong>0.48</strong></td>
<td>PDFM</td>
<td>Super‑resolución (27 tareas)</td>
<td>Salud (media) <strong>0.46</strong>; IDW mejor en Elevación</td>
</tr>
<tr class="even">
<td>MAPE = <strong>0.1132</strong></td>
<td>TimesFM(t‑1)+PDFM</td>
<td>Desempleo (condado)</td>
<td>Mejora vs TimesFM(t) 0.1186 y ARIMA 0.1160</td>
</tr>
<tr class="odd">
<td>MAPE = <strong>0.2577</strong></td>
<td>TimesFM(t‑1)+PDFM</td>
<td>Pobreza (ZIP)</td>
<td>Mejora vs TimesFM(t) 0.3215 y ARIMA 0.2934</td>
</tr>
</tbody>
</table>
<p><strong>Métricas Globales</strong>:</p>
<p><img src="images/agawarl-tbl-global.png" class="img-fluid"></p>
</section>
<section id="replicabilidad-recursos" class="level3" data-number="6.4.5">
<h3 data-number="6.4.5" class="anchored" data-anchor-id="replicabilidad-recursos"><span class="header-section-number">6.4.5</span> Replicabilidad &amp; Recursos</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Ítem</th>
<th>Sí/No</th>
<th>Detalle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Código disponible</td>
<td>Sí</td>
<td>GitHub <strong>google-research/population-dynamics</strong> (embeddings, datos procesados y ejemplos)</td>
</tr>
<tr class="even">
<td>Datos <em>embeddings</em></td>
<td>Sí</td>
<td><em>Embeddings</em> PDFM públicos; etiquetas de benchmark vía Data Commons/Earth Engine</td>
</tr>
<tr class="odd">
<td>Pesos del modelo GNN</td>
<td>No</td>
<td><span class="highlight">Se publican embeddings pero no pesos entrenados completos</span></td>
</tr>
<tr class="even">
<td>Documentación de <em>splits</em></td>
<td>Sí</td>
<td>Esquemas de <em>holdouts</em> y tablas de resultados en el preprint</td>
</tr>
<tr class="odd">
<td>Declaración de conflictos</td>
<td>Sí</td>
<td>Financiado por Alphabet; autores empleados</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="resultados-clave" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="resultados-clave"><span class="header-section-number">6.5</span> Resultados Clave</h2>
<ul>
<li>PDFM logra <strong>SoTA en interpolación</strong> en las 27 tareas (R² medio 0.83).<br>
</li>
<li><strong>25/27 tareas</strong> con mejor desempeño en extrapolación y super‑resolución.<br>
</li>
<li><strong>Búsquedas agregadas</strong> destacan en predicción socioeconómica (night lights, densidad poblacional).<br>
</li>
<li><strong>Mapas</strong> predicen bien night lights; <strong>SatCLIP</strong> útil en elevación.<br>
</li>
<li><strong>Pronósticos</strong> de desempleo y pobreza mejoran 5–20% en MAPE al combinar PDFM con TimesFM.<br>
</li>
<li>Concatenar SatCLIP + PDFM mejora interpolación y super‑resolución, no siempre extrapolación.</li>
</ul>
</section>
<section id="discusión" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="discusión"><span class="header-section-number">6.6</span> Discusión</h2>
<ul>
<li><strong>Contribuciones:</strong>
<ul>
<li>Primer marco fundacional geoespacial multimodal validado en 27 tareas.<br>
</li>
<li>Embeddings desagregados por fuente, aportando interpretabilidad.<br>
</li>
<li>Adaptabilidad a forecasting (TimesFM).<br>
</li>
</ul></li>
<li><strong>Limitaciones:</strong>
<ul>
<li>Desalineación temporal de fuentes.<br>
</li>
<li>Alcance geográfico limitado a EE.UU.<br>
</li>
<li>Embeddings estáticos (no dinámicos).<br>
</li>
<li>Riesgos de privacidad y sesgos poblacionales.<br>
</li>
</ul></li>
<li><strong>Futuro:</strong>
<ul>
<li>Extensión global y en regímenes de baja‑datos.<br>
</li>
<li>Inclusión de aristas espaciotemporales y movilidad.<br>
</li>
<li>Garantías de privacidad diferencial.</li>
</ul></li>
</ul>
</section>
<section id="aplicabilidad-en-chile" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="aplicabilidad-en-chile"><span class="header-section-number">6.7</span> Aplicabilidad en Chile</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Aspecto</th>
<th>Evaluación</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Disponibilidad de insumos</strong></td>
<td>POIs, clima y calidad del aire disponibles; búsquedas/afluencia dependerán de acuerdos y privacidad</td>
</tr>
<tr class="even">
<td><strong>Unidades espaciales</strong></td>
<td>Adaptable a comunas, zonas censales, manzanas</td>
</tr>
<tr class="odd">
<td><strong>Tareas prioritarias</strong></td>
<td>Salud (obesidad, hipertensión), pobreza, vulnerabilidad social, contaminación</td>
</tr>
<tr class="even">
<td><strong>Implementación</strong></td>
<td>Uso de embeddings publicados como arranque; downstream con etiquetas locales (INE, DEIS, MINSAL)</td>
</tr>
<tr class="odd">
<td><strong>Riesgos</strong></td>
<td>Sesgos por estructura urbano/rural distinta; validación externa necesaria</td>
</tr>
<tr class="even">
<td><strong>Privacidad</strong></td>
<td>Requiere anonimización fuerte / privacidad diferencial</td>
</tr>
</tbody>
</table>
</section>
<section id="madurez-evidencia" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="madurez-evidencia"><span class="header-section-number">6.8</span> Madurez &amp; Evidencia</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Eje</th>
<th>Nivel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>TRL (estimado)</strong></td>
<td>5–6</td>
</tr>
<tr class="even">
<td><strong>Robustez metodológica</strong></td>
<td>Alta en interpolación; media en extrapolación/super‑resolución</td>
</tr>
<tr class="odd">
<td><strong>Reproducibilidad</strong></td>
<td>Media‑alta (código y embeddings públicos; insumos propietarios limitan)</td>
</tr>
<tr class="even">
<td><strong>Generalización geográfica</strong></td>
<td>Media (foco en EE.UU.)</td>
</tr>
<tr class="odd">
<td><strong>Transparencia/interpretabilidad</strong></td>
<td>Media</td>
</tr>
</tbody>
</table>
</section>
<section id="impacto-en-políticas-públicas-ods" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="impacto-en-políticas-públicas-ods"><span class="header-section-number">6.9</span> Impacto en Políticas Públicas / ODS</h2>
<p>Según los autores creen que que el <strong>PDFM</strong> puede aplicarse a una variedad de aplicaciones en distintos dominios, incluyendo:</p>
<ul>
<li><strong>Salud pública</strong>: El PDFM podría utilizarse en modelos que predicen la prevalencia y propagación de enfermedades para ayudar a informar las políticas de salud pública y las decisiones de asignación de recursos.</li>
<li><strong>Retail</strong>: El PDFM podría ser usado por analistas del sector minorista para considerar factores como la densidad de población, los intereses de los consumidores y la presencia de competidores en sus procesos de toma de decisiones.</li>
<li><strong>Análisis de impacto del riesgo climático</strong>: Los científicos ambientales podrían aplicar el PDFM en modelos que monitorean el impacto humano de la deforestación, los cambios en la calidad del aire y el efecto del cambio climático en diferentes regiones.</li>
<li>I<strong>ndicadores macroeconómicos y socioeconómicos</strong>: El PDFM podría usarse para caracterizar regiones mediante embeddings con el fin de optimizar indicadores macroeconómicos y socioeconómicos como el PIB o el desempleo.</li>
</ul>
<blockquote class="blockquote">
<p>Puede apoyar focalización territorial en salud y asistencia social, planificación urbana y monitoreo ambiental. Contribuye a <strong>ODS 3</strong>, <strong>ODS 10</strong>, <strong>ODS 11</strong>, <strong>ODS 13</strong> al facilitar un marco replicable y flexible para análisis territorial.</p>
</blockquote>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-agarwal2024pdfm" class="csl-entry" role="listitem">
Agarwal, Mohit, Mimi Sun, Chaitanya Kamath, Arbaaz Muslim, Prithul Sarker, Joydeep Paul, Hector Yee, et al. 2024. <span>“General Geospatial Inference with a Population Dynamics Foundation Model.”</span> <em>arXiv Preprint arXiv:2411.07207</em>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./han-2018.html" class="pagination-link" aria-label="LLM - Urban Agents">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">LLM - Urban Agents</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./reza-2025.html" class="pagination-link" aria-label="Crix - Crime and Demographics">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Crix - Crime and Demographics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Denis Berroeta</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>